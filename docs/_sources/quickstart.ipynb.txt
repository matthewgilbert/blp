{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Quickstart Guide\n",
    "\n",
    "We highly advise thoroughly reviewing the [BLPAPI Core Developer Guide](https://data.bloomberglp.com/professional/sites/10/2017/03/BLPAPI-Core-Developer-Guide.pdf) when developing your Bloomberg Queries. This guide is essential for understanding function parameters, request options, overrides, error messages, and troubleshooting methods."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import datetime\n",
    "import json\n",
    "\n",
    "import pandas\n",
    "\n",
    "from blp import blp"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "bquery = blp.BlpQuery().start()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Bloomberg Queries\n",
    "\n",
    "## Data History (BDH)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>security</th>\n",
       "      <th>PX_LAST</th>\n",
       "      <th>VOLUME</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2019-01-02</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>250.18</td>\n",
       "      <td>126925199.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2019-01-02</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>122.15</td>\n",
       "      <td>19841527.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2019-01-03</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>244.21</td>\n",
       "      <td>144140692.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2019-01-03</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>123.54</td>\n",
       "      <td>21187045.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2019-01-04</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>252.39</td>\n",
       "      <td>142628834.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2019-01-04</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>122.11</td>\n",
       "      <td>12970226.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2019-01-07</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>254.38</td>\n",
       "      <td>103139100.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2019-01-07</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>121.75</td>\n",
       "      <td>8498104.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2019-01-08</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>256.77</td>\n",
       "      <td>102512587.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2019-01-08</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>121.43</td>\n",
       "      <td>7737103.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2019-01-09</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>257.97</td>\n",
       "      <td>95006554.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2019-01-09</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>121.24</td>\n",
       "      <td>9349245.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2019-01-10</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>258.88</td>\n",
       "      <td>96823923.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2019-01-10</td>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>120.46</td>\n",
       "      <td>8222860.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date       security  PX_LAST       VOLUME\n",
       "0  2019-01-02  SPY US Equity   250.18  126925199.0\n",
       "1  2019-01-02  TLT US Equity   122.15   19841527.0\n",
       "2  2019-01-03  SPY US Equity   244.21  144140692.0\n",
       "3  2019-01-03  TLT US Equity   123.54   21187045.0\n",
       "4  2019-01-04  SPY US Equity   252.39  142628834.0\n",
       "5  2019-01-04  TLT US Equity   122.11   12970226.0\n",
       "6  2019-01-07  SPY US Equity   254.38  103139100.0\n",
       "7  2019-01-07  TLT US Equity   121.75    8498104.0\n",
       "8  2019-01-08  SPY US Equity   256.77  102512587.0\n",
       "9  2019-01-08  TLT US Equity   121.43    7737103.0\n",
       "10 2019-01-09  SPY US Equity   257.97   95006554.0\n",
       "11 2019-01-09  TLT US Equity   121.24    9349245.0\n",
       "12 2019-01-10  SPY US Equity   258.88   96823923.0\n",
       "13 2019-01-10  TLT US Equity   120.46    8222860.0"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bdh(\n",
    "    [\"SPY US Equity\", \"TLT US Equity\"],\n",
    "    [\"PX_LAST\", \"VOLUME\"],\n",
    "    start_date=\"20190101\",\n",
    "    end_date=\"20190110\",\n",
    "    options={\"adjustmentSplit\": True}\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Data Point (BDP)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>security</th>\n",
       "      <th>NAME</th>\n",
       "      <th>PX_LAST</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>CL1 Comdty</td>\n",
       "      <td>Generic 1st 'CL' Future</td>\n",
       "      <td>77.43</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     security                     NAME  PX_LAST\n",
       "0  CL1 Comdty  Generic 1st 'CL' Future    77.43"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bdp([\"CL1 Comdty\"], [\"NAME\", \"PX_LAST\"])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Data Set (BDS)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Member Ticker and Exchange Code</th>\n",
       "      <th>Percentage Weight</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>BOF4</td>\n",
       "      <td>2.80</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>C H4</td>\n",
       "      <td>4.24</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>CLF4</td>\n",
       "      <td>8.44</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>COH4</td>\n",
       "      <td>7.81</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>CTH4</td>\n",
       "      <td>1.53</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>GCG4</td>\n",
       "      <td>16.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>HGH4</td>\n",
       "      <td>5.30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>HOF4</td>\n",
       "      <td>2.07</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>KCH4</td>\n",
       "      <td>3.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>KWH4</td>\n",
       "      <td>1.35</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>LAF24</td>\n",
       "      <td>4.12</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>LCG4</td>\n",
       "      <td>3.86</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>LHG4</td>\n",
       "      <td>1.68</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>LLF4</td>\n",
       "      <td>1.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>LNF4</td>\n",
       "      <td>1.73</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>LXF4</td>\n",
       "      <td>2.54</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>NGF24</td>\n",
       "      <td>7.37</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>QSF4</td>\n",
       "      <td>2.71</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>S F4</td>\n",
       "      <td>5.47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>SBH4</td>\n",
       "      <td>3.84</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>SIH4</td>\n",
       "      <td>4.74</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>SMF4</td>\n",
       "      <td>3.38</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>W H4</td>\n",
       "      <td>2.21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>XBF4</td>\n",
       "      <td>2.21</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Member Ticker and Exchange Code  Percentage Weight\n",
       "0                             BOF4               2.80\n",
       "1                             C H4               4.24\n",
       "2                             CLF4               8.44\n",
       "3                             COH4               7.81\n",
       "4                             CTH4               1.53\n",
       "5                             GCG4              16.41\n",
       "6                             HGH4               5.30\n",
       "7                             HOF4               2.07\n",
       "8                             KCH4               3.19\n",
       "9                             KWH4               1.35\n",
       "10                           LAF24               4.12\n",
       "11                            LCG4               3.86\n",
       "12                            LHG4               1.68\n",
       "13                            LLF4               1.00\n",
       "14                            LNF4               1.73\n",
       "15                            LXF4               2.54\n",
       "16                           NGF24               7.37\n",
       "17                            QSF4               2.71\n",
       "18                            S F4               5.47\n",
       "19                            SBH4               3.84\n",
       "20                            SIH4               4.74\n",
       "21                            SMF4               3.38\n",
       "22                            W H4               2.21\n",
       "23                            XBF4               2.21"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bds(\"BCOM Index\", \"INDX_MWEIGHT\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Intraday Bar (BDIB)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>time</th>\n",
       "      <th>open</th>\n",
       "      <th>high</th>\n",
       "      <th>low</th>\n",
       "      <th>close</th>\n",
       "      <th>volume</th>\n",
       "      <th>numEvents</th>\n",
       "      <th>value</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2023-11-01 13:30:00</td>\n",
       "      <td>171.000</td>\n",
       "      <td>171.97</td>\n",
       "      <td>170.120</td>\n",
       "      <td>171.828</td>\n",
       "      <td>8272888</td>\n",
       "      <td>41465</td>\n",
       "      <td>1.415716e+09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2023-11-01 14:30:00</td>\n",
       "      <td>171.835</td>\n",
       "      <td>172.08</td>\n",
       "      <td>171.000</td>\n",
       "      <td>171.430</td>\n",
       "      <td>5189464</td>\n",
       "      <td>26241</td>\n",
       "      <td>8.903882e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2023-11-01 15:30:00</td>\n",
       "      <td>171.440</td>\n",
       "      <td>172.00</td>\n",
       "      <td>171.195</td>\n",
       "      <td>171.910</td>\n",
       "      <td>2887219</td>\n",
       "      <td>14505</td>\n",
       "      <td>4.957753e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2023-11-01 16:30:00</td>\n",
       "      <td>171.905</td>\n",
       "      <td>172.38</td>\n",
       "      <td>171.630</td>\n",
       "      <td>172.162</td>\n",
       "      <td>3109733</td>\n",
       "      <td>14308</td>\n",
       "      <td>5.350173e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2023-11-01 17:30:00</td>\n",
       "      <td>172.160</td>\n",
       "      <td>172.71</td>\n",
       "      <td>171.910</td>\n",
       "      <td>172.620</td>\n",
       "      <td>4089553</td>\n",
       "      <td>20561</td>\n",
       "      <td>7.043825e+08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2023-11-01 18:30:00</td>\n",
       "      <td>172.620</td>\n",
       "      <td>174.22</td>\n",
       "      <td>172.100</td>\n",
       "      <td>173.910</td>\n",
       "      <td>8659156</td>\n",
       "      <td>46255</td>\n",
       "      <td>1.499576e+09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2023-11-01 19:30:00</td>\n",
       "      <td>173.920</td>\n",
       "      <td>174.23</td>\n",
       "      <td>173.610</td>\n",
       "      <td>173.970</td>\n",
       "      <td>13746588</td>\n",
       "      <td>32967</td>\n",
       "      <td>2.391479e+09</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                 time     open    high      low    close    volume  numEvents  \\\n",
       "0 2023-11-01 13:30:00  171.000  171.97  170.120  171.828   8272888      41465   \n",
       "1 2023-11-01 14:30:00  171.835  172.08  171.000  171.430   5189464      26241   \n",
       "2 2023-11-01 15:30:00  171.440  172.00  171.195  171.910   2887219      14505   \n",
       "3 2023-11-01 16:30:00  171.905  172.38  171.630  172.162   3109733      14308   \n",
       "4 2023-11-01 17:30:00  172.160  172.71  171.910  172.620   4089553      20561   \n",
       "5 2023-11-01 18:30:00  172.620  174.22  172.100  173.910   8659156      46255   \n",
       "6 2023-11-01 19:30:00  173.920  174.23  173.610  173.970  13746588      32967   \n",
       "\n",
       "          value  \n",
       "0  1.415716e+09  \n",
       "1  8.903882e+08  \n",
       "2  4.957753e+08  \n",
       "3  5.350173e+08  \n",
       "4  7.043825e+08  \n",
       "5  1.499576e+09  \n",
       "6  2.391479e+09  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bdib(\n",
    "    \"AAPL US Equity\",\n",
    "    event_type=\"TRADE\",\n",
    "    interval=60,\n",
    "    start_datetime=\"2023-11-01\", # Different date format\n",
    "    end_datetime=\"2023-11-02\", # Different date format\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Equity Screening (BEQS)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>security</th>\n",
       "      <th>Price:D-1</th>\n",
       "      <th>Market Cap</th>\n",
       "      <th>S&amp;P LT FC Iss Cred Rtg</th>\n",
       "      <th>Ticker</th>\n",
       "      <th>Moody's Issuer Rtg</th>\n",
       "      <th>Tier 1 Cap Rt LF</th>\n",
       "      <th>Tot Rsk Bsd Cap Rt LF</th>\n",
       "      <th>Short Name</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>8331 JP</td>\n",
       "      <td>7.451469</td>\n",
       "      <td>6.089966e+09</td>\n",
       "      <td>A-</td>\n",
       "      <td>8331 JP</td>\n",
       "      <td>A1</td>\n",
       "      <td>11.510000</td>\n",
       "      <td>11.580000</td>\n",
       "      <td>CHIBA BANK LTD</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ABN NA</td>\n",
       "      <td>13.956888</td>\n",
       "      <td>1.201920e+10</td>\n",
       "      <td>A</td>\n",
       "      <td>ABN NA</td>\n",
       "      <td>A1</td>\n",
       "      <td>16.500000</td>\n",
       "      <td>19.799999</td>\n",
       "      <td>ABN AMRO BANK-CV</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>ACA FP</td>\n",
       "      <td>12.911215</td>\n",
       "      <td>3.946861e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>ACA FP</td>\n",
       "      <td>Aa3</td>\n",
       "      <td>13.700000</td>\n",
       "      <td>17.900000</td>\n",
       "      <td>CREDIT AGRICOLE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>BAC US</td>\n",
       "      <td>30.010000</td>\n",
       "      <td>2.372537e+11</td>\n",
       "      <td>A-</td>\n",
       "      <td>BAC US</td>\n",
       "      <td>A1</td>\n",
       "      <td>13.600000</td>\n",
       "      <td>15.400000</td>\n",
       "      <td>BANK OF AMERICA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>BBVA SM</td>\n",
       "      <td>9.063227</td>\n",
       "      <td>5.414058e+10</td>\n",
       "      <td>A</td>\n",
       "      <td>BBVA SM</td>\n",
       "      <td>A3</td>\n",
       "      <td>14.450000</td>\n",
       "      <td>16.510000</td>\n",
       "      <td>BBVA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>BNP FP</td>\n",
       "      <td>62.127838</td>\n",
       "      <td>7.159116e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>BNP FP</td>\n",
       "      <td>Aa3</td>\n",
       "      <td>15.500000</td>\n",
       "      <td>17.799999</td>\n",
       "      <td>BNP PARIBAS</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>BNS CN</td>\n",
       "      <td>44.430687</td>\n",
       "      <td>5.364239e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>BNS CN</td>\n",
       "      <td>A2</td>\n",
       "      <td>14.600000</td>\n",
       "      <td>16.900000</td>\n",
       "      <td>BANK OF NOVA SCO</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>CBK GR</td>\n",
       "      <td>12.299781</td>\n",
       "      <td>1.511882e+10</td>\n",
       "      <td>A-</td>\n",
       "      <td>CBK GR</td>\n",
       "      <td>A2</td>\n",
       "      <td>16.500000</td>\n",
       "      <td>19.200001</td>\n",
       "      <td>COMMERZBANK</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>CFR US</td>\n",
       "      <td>99.370003</td>\n",
       "      <td>6.354122e+09</td>\n",
       "      <td>A-</td>\n",
       "      <td>CFR US</td>\n",
       "      <td>A3</td>\n",
       "      <td>13.810000</td>\n",
       "      <td>15.280000</td>\n",
       "      <td>CULLEN/FROST</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>DANSKE DC</td>\n",
       "      <td>26.030893</td>\n",
       "      <td>2.243711e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>DANSKE DC</td>\n",
       "      <td>A3</td>\n",
       "      <td>20.600000</td>\n",
       "      <td>23.200001</td>\n",
       "      <td>DANSKE BANK A/S</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>DBK GR</td>\n",
       "      <td>12.324938</td>\n",
       "      <td>2.518035e+10</td>\n",
       "      <td>A-</td>\n",
       "      <td>DBK GR</td>\n",
       "      <td>A1</td>\n",
       "      <td>16.299999</td>\n",
       "      <td>18.799999</td>\n",
       "      <td>DEUTSCHE BANK-RG</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>JPM US</td>\n",
       "      <td>153.289993</td>\n",
       "      <td>4.418039e+11</td>\n",
       "      <td>A-</td>\n",
       "      <td>JPM US</td>\n",
       "      <td>A1</td>\n",
       "      <td>15.900000</td>\n",
       "      <td>17.799999</td>\n",
       "      <td>JPMORGAN CHASE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>NA CN</td>\n",
       "      <td>66.278137</td>\n",
       "      <td>2.250676e+10</td>\n",
       "      <td>A</td>\n",
       "      <td>NA CN</td>\n",
       "      <td>A3</td>\n",
       "      <td>16.100000</td>\n",
       "      <td>16.900000</td>\n",
       "      <td>NATL BK CANADA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>NAB AU</td>\n",
       "      <td>18.291357</td>\n",
       "      <td>5.732886e+10</td>\n",
       "      <td>AA-</td>\n",
       "      <td>NAB AU</td>\n",
       "      <td>Aa3</td>\n",
       "      <td>14.190000</td>\n",
       "      <td>19.879999</td>\n",
       "      <td>NATL AUST BANK</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>PNC US</td>\n",
       "      <td>130.339996</td>\n",
       "      <td>5.188792e+10</td>\n",
       "      <td>A-</td>\n",
       "      <td>PNC US</td>\n",
       "      <td>A3</td>\n",
       "      <td>11.500000</td>\n",
       "      <td>13.400000</td>\n",
       "      <td>PNC FINANCIAL SE</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>RY CN</td>\n",
       "      <td>87.805054</td>\n",
       "      <td>1.230937e+11</td>\n",
       "      <td>AA-</td>\n",
       "      <td>RY CN</td>\n",
       "      <td>A1</td>\n",
       "      <td>15.400000</td>\n",
       "      <td>17.299999</td>\n",
       "      <td>ROYAL BANK OF CA</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>SAN SM</td>\n",
       "      <td>4.084249</td>\n",
       "      <td>6.619073e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>SAN SM</td>\n",
       "      <td>A2</td>\n",
       "      <td>13.800000</td>\n",
       "      <td>16.299999</td>\n",
       "      <td>BANCO SANTANDER</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>SEBA SS</td>\n",
       "      <td>12.084361</td>\n",
       "      <td>2.589788e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>SEBA SS</td>\n",
       "      <td>Aa3</td>\n",
       "      <td>20.600000</td>\n",
       "      <td>21.900000</td>\n",
       "      <td>SEB AB-A</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>SHBA SS</td>\n",
       "      <td>9.459072</td>\n",
       "      <td>1.885026e+10</td>\n",
       "      <td>AA-</td>\n",
       "      <td>SHBA SS</td>\n",
       "      <td>Aa2</td>\n",
       "      <td>21.200001</td>\n",
       "      <td>24.500000</td>\n",
       "      <td>SVENSKA HAN-A</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>SWEDA SS</td>\n",
       "      <td>17.638960</td>\n",
       "      <td>2.001985e+10</td>\n",
       "      <td>A+</td>\n",
       "      <td>SWEDA SS</td>\n",
       "      <td>Aa3</td>\n",
       "      <td>20.500000</td>\n",
       "      <td>23.000000</td>\n",
       "      <td>SWEDBANK AB-A</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>TD CN</td>\n",
       "      <td>61.994610</td>\n",
       "      <td>1.112967e+11</td>\n",
       "      <td>AA-</td>\n",
       "      <td>TD CN</td>\n",
       "      <td>A1</td>\n",
       "      <td>17.200001</td>\n",
       "      <td>19.600000</td>\n",
       "      <td>TORONTO-DOM BANK</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>TFC US</td>\n",
       "      <td>32.040001</td>\n",
       "      <td>4.263737e+10</td>\n",
       "      <td>A-</td>\n",
       "      <td>TFC US</td>\n",
       "      <td>A3</td>\n",
       "      <td>11.400000</td>\n",
       "      <td>13.500000</td>\n",
       "      <td>TRUIST FINANCIAL</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>USB US</td>\n",
       "      <td>37.630001</td>\n",
       "      <td>5.860595e+10</td>\n",
       "      <td>A</td>\n",
       "      <td>USB US</td>\n",
       "      <td>A3</td>\n",
       "      <td>11.200000</td>\n",
       "      <td>13.400000</td>\n",
       "      <td>US BANCORP</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>WBC AU</td>\n",
       "      <td>13.896977</td>\n",
       "      <td>4.891449e+10</td>\n",
       "      <td>AA-</td>\n",
       "      <td>WBC AU</td>\n",
       "      <td>Aa3</td>\n",
       "      <td>14.590000</td>\n",
       "      <td>20.450001</td>\n",
       "      <td>WESTPAC BANKING</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     security   Price:D-1    Market Cap S&P LT FC Iss Cred Rtg     Ticker  \\\n",
       "0     8331 JP    7.451469  6.089966e+09                     A-    8331 JP   \n",
       "1      ABN NA   13.956888  1.201920e+10                      A     ABN NA   \n",
       "2      ACA FP   12.911215  3.946861e+10                     A+     ACA FP   \n",
       "3      BAC US   30.010000  2.372537e+11                     A-     BAC US   \n",
       "4     BBVA SM    9.063227  5.414058e+10                      A    BBVA SM   \n",
       "5      BNP FP   62.127838  7.159116e+10                     A+     BNP FP   \n",
       "6      BNS CN   44.430687  5.364239e+10                     A+     BNS CN   \n",
       "7      CBK GR   12.299781  1.511882e+10                     A-     CBK GR   \n",
       "8      CFR US   99.370003  6.354122e+09                     A-     CFR US   \n",
       "9   DANSKE DC   26.030893  2.243711e+10                     A+  DANSKE DC   \n",
       "10     DBK GR   12.324938  2.518035e+10                     A-     DBK GR   \n",
       "11     JPM US  153.289993  4.418039e+11                     A-     JPM US   \n",
       "12      NA CN   66.278137  2.250676e+10                      A      NA CN   \n",
       "13     NAB AU   18.291357  5.732886e+10                    AA-     NAB AU   \n",
       "14     PNC US  130.339996  5.188792e+10                     A-     PNC US   \n",
       "15      RY CN   87.805054  1.230937e+11                    AA-      RY CN   \n",
       "16     SAN SM    4.084249  6.619073e+10                     A+     SAN SM   \n",
       "17    SEBA SS   12.084361  2.589788e+10                     A+    SEBA SS   \n",
       "18    SHBA SS    9.459072  1.885026e+10                    AA-    SHBA SS   \n",
       "19   SWEDA SS   17.638960  2.001985e+10                     A+   SWEDA SS   \n",
       "20      TD CN   61.994610  1.112967e+11                    AA-      TD CN   \n",
       "21     TFC US   32.040001  4.263737e+10                     A-     TFC US   \n",
       "22     USB US   37.630001  5.860595e+10                      A     USB US   \n",
       "23     WBC AU   13.896977  4.891449e+10                    AA-     WBC AU   \n",
       "\n",
       "   Moody's Issuer Rtg  Tier 1 Cap Rt LF  Tot Rsk Bsd Cap Rt LF  \\\n",
       "0                  A1         11.510000              11.580000   \n",
       "1                  A1         16.500000              19.799999   \n",
       "2                 Aa3         13.700000              17.900000   \n",
       "3                  A1         13.600000              15.400000   \n",
       "4                  A3         14.450000              16.510000   \n",
       "5                 Aa3         15.500000              17.799999   \n",
       "6                  A2         14.600000              16.900000   \n",
       "7                  A2         16.500000              19.200001   \n",
       "8                  A3         13.810000              15.280000   \n",
       "9                  A3         20.600000              23.200001   \n",
       "10                 A1         16.299999              18.799999   \n",
       "11                 A1         15.900000              17.799999   \n",
       "12                 A3         16.100000              16.900000   \n",
       "13                Aa3         14.190000              19.879999   \n",
       "14                 A3         11.500000              13.400000   \n",
       "15                 A1         15.400000              17.299999   \n",
       "16                 A2         13.800000              16.299999   \n",
       "17                Aa3         20.600000              21.900000   \n",
       "18                Aa2         21.200001              24.500000   \n",
       "19                Aa3         20.500000              23.000000   \n",
       "20                 A1         17.200001              19.600000   \n",
       "21                 A3         11.400000              13.500000   \n",
       "22                 A3         11.200000              13.400000   \n",
       "23                Aa3         14.590000              20.450001   \n",
       "\n",
       "          Short Name  \n",
       "0     CHIBA BANK LTD  \n",
       "1   ABN AMRO BANK-CV  \n",
       "2    CREDIT AGRICOLE  \n",
       "3    BANK OF AMERICA  \n",
       "4               BBVA  \n",
       "5        BNP PARIBAS  \n",
       "6   BANK OF NOVA SCO  \n",
       "7        COMMERZBANK  \n",
       "8       CULLEN/FROST  \n",
       "9    DANSKE BANK A/S  \n",
       "10  DEUTSCHE BANK-RG  \n",
       "11    JPMORGAN CHASE  \n",
       "12    NATL BK CANADA  \n",
       "13    NATL AUST BANK  \n",
       "14  PNC FINANCIAL SE  \n",
       "15  ROYAL BANK OF CA  \n",
       "16   BANCO SANTANDER  \n",
       "17          SEB AB-A  \n",
       "18     SVENSKA HAN-A  \n",
       "19     SWEDBANK AB-A  \n",
       "20  TORONTO-DOM BANK  \n",
       "21  TRUIST FINANCIAL  \n",
       "22        US BANCORP  \n",
       "23   WESTPAC BANKING  "
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.beqs(\n",
    "    \"Core Capital Ratios\",\n",
    "    screen_type=\"GLOBAL\",\n",
    "    options={\"Group\": \"General\"}\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## BQL Queries\n",
    "\n",
    "`bquery.bql` accepts a Bloomberg Query String. For optimal query creation, utilize Excel's BQL Builder in Advanced View. Once your query is ready, click the \"Copy\" button to copy it, and then paste it into the `bquery.bql` argument."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>security</th>\n",
       "      <th>field</th>\n",
       "      <th>secondary_name</th>\n",
       "      <th>secondary_value</th>\n",
       "      <th>value</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>IBM US Equity</td>\n",
       "      <td>px_last</td>\n",
       "      <td>CURRENCY</td>\n",
       "      <td>USD</td>\n",
       "      <td>154.35</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>AAPL US Equity</td>\n",
       "      <td>px_last</td>\n",
       "      <td>CURRENCY</td>\n",
       "      <td>USD</td>\n",
       "      <td>191.45</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>IBM US Equity</td>\n",
       "      <td>px_last</td>\n",
       "      <td>DATE</td>\n",
       "      <td>2023-11-21T00:00:00Z</td>\n",
       "      <td>154.35</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>AAPL US Equity</td>\n",
       "      <td>px_last</td>\n",
       "      <td>DATE</td>\n",
       "      <td>2023-11-21T00:00:00Z</td>\n",
       "      <td>191.45</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         security    field secondary_name       secondary_value   value\n",
       "0   IBM US Equity  px_last       CURRENCY                   USD  154.35\n",
       "1  AAPL US Equity  px_last       CURRENCY                   USD  191.45\n",
       "2   IBM US Equity  px_last           DATE  2023-11-21T00:00:00Z  154.35\n",
       "3  AAPL US Equity  px_last           DATE  2023-11-21T00:00:00Z  191.45"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bql(\"get(px_last) for(['IBM US Equity', 'AAPL US Equity'])\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Advanced Query Techniques\n",
    "\n",
    "## Using Overrides\n",
    "\n",
    "Various fields can be overriden. For info on what fields support what overrides, the best place to check is using `FLDS` from the terminal."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th colspan=\"2\" halign=\"left\">default</th>\n",
       "      <th colspan=\"2\" halign=\"left\">override</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th></th>\n",
       "      <th>security</th>\n",
       "      <th>CRNCY_ADJ_PX_LAST</th>\n",
       "      <th>security</th>\n",
       "      <th>CRNCY_ADJ_PX_LAST</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>IBM US Equity</td>\n",
       "      <td>154.35</td>\n",
       "      <td>IBM US Equity</td>\n",
       "      <td>140.7789</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         default                         override                  \n",
       "        security CRNCY_ADJ_PX_LAST       security CRNCY_ADJ_PX_LAST\n",
       "0  IBM US Equity            154.35  IBM US Equity          140.7789"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pandas.concat(\n",
    "    [\n",
    "        bquery.bdp([\"IBM US Equity\"], [\"CRNCY_ADJ_PX_LAST\"]),\n",
    "        bquery.bdp(\n",
    "            [\"IBM US Equity\"], [\"CRNCY_ADJ_PX_LAST\"], overrides=[(\"EQY_FUND_CRNCY\", \"EUR\")]\n",
    "        )\n",
    "    ],\n",
    "    axis=1,\n",
    "    keys=[\"default\", \"override\"]\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Index Member</th>\n",
       "      <th>Percent Weight</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1COV GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>ADS GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>AIR GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>ALV GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>BAS GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>BAYN GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>BEI GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>BMW GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>BNR GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>CBK GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>CON GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>DB1 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>DBK GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>DHL GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>DTE GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>DTG GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>ENR GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>EOAN GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>FRE GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>HEI GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>HEN3 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>HNR1 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>IFX GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>MBG GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>MRK GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>MTX GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>MUV2 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>P911 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>PAH3 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>QIA GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>RHM GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>RWE GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>SAP GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>SHL GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>SIE GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>SRT3 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>SY1 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>VNA GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>VOW3 GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>ZAL GY</td>\n",
       "      <td>-2.424536e-14</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Index Member  Percent Weight\n",
       "0       1COV GY   -2.424536e-14\n",
       "1        ADS GY   -2.424536e-14\n",
       "2        AIR GY   -2.424536e-14\n",
       "3        ALV GY   -2.424536e-14\n",
       "4        BAS GY   -2.424536e-14\n",
       "5       BAYN GY   -2.424536e-14\n",
       "6        BEI GY   -2.424536e-14\n",
       "7        BMW GY   -2.424536e-14\n",
       "8        BNR GY   -2.424536e-14\n",
       "9        CBK GY   -2.424536e-14\n",
       "10       CON GY   -2.424536e-14\n",
       "11       DB1 GY   -2.424536e-14\n",
       "12       DBK GY   -2.424536e-14\n",
       "13       DHL GY   -2.424536e-14\n",
       "14       DTE GY   -2.424536e-14\n",
       "15       DTG GY   -2.424536e-14\n",
       "16       ENR GY   -2.424536e-14\n",
       "17      EOAN GY   -2.424536e-14\n",
       "18       FRE GY   -2.424536e-14\n",
       "19       HEI GY   -2.424536e-14\n",
       "20      HEN3 GY   -2.424536e-14\n",
       "21      HNR1 GY   -2.424536e-14\n",
       "22       IFX GY   -2.424536e-14\n",
       "23       MBG GY   -2.424536e-14\n",
       "24       MRK GY   -2.424536e-14\n",
       "25       MTX GY   -2.424536e-14\n",
       "26      MUV2 GY   -2.424536e-14\n",
       "27      P911 GY   -2.424536e-14\n",
       "28      PAH3 GY   -2.424536e-14\n",
       "29       QIA GY   -2.424536e-14\n",
       "30       RHM GY   -2.424536e-14\n",
       "31       RWE GY   -2.424536e-14\n",
       "32       SAP GY   -2.424536e-14\n",
       "33       SHL GY   -2.424536e-14\n",
       "34       SIE GY   -2.424536e-14\n",
       "35      SRT3 GY   -2.424536e-14\n",
       "36       SY1 GY   -2.424536e-14\n",
       "37       VNA GY   -2.424536e-14\n",
       "38      VOW3 GY   -2.424536e-14\n",
       "39       ZAL GY   -2.424536e-14"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bds(\n",
    "    \"DAX Index\",\n",
    "    \"INDX_MWEIGHT_HIST\",\n",
    "    overrides=[(\"END_DATE_OVERRIDE\", \"20230630\")],\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Using SEDOLs"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>security</th>\n",
       "      <th>ID_SEDOL1</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>2840215</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>TLT US Equity</td>\n",
       "      <td>2971546</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        security ID_SEDOL1\n",
       "0  SPY US Equity   2840215\n",
       "1  TLT US Equity   2971546"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bdp(\n",
    "    [\"SPY US Equity\", \"TLT US Equity\"],\n",
    "    [\"ID_SEDOL1\"],\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>security</th>\n",
       "      <th>PX_LAST</th>\n",
       "      <th>VOLUME</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2019-01-02</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>231.4905</td>\n",
       "      <td>126925199.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2019-01-02</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>110.0483</td>\n",
       "      <td>19841527.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2019-01-03</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>225.9664</td>\n",
       "      <td>144140692.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2019-01-03</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>111.3006</td>\n",
       "      <td>21187045.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2019-01-04</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>233.5354</td>\n",
       "      <td>142628834.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2019-01-04</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>110.0123</td>\n",
       "      <td>12970226.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2019-01-07</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>235.3767</td>\n",
       "      <td>103139100.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2019-01-07</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>109.6879</td>\n",
       "      <td>8498104.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2019-01-08</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>237.5882</td>\n",
       "      <td>102512587.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2019-01-08</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>109.3996</td>\n",
       "      <td>7737103.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2019-01-09</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>238.6985</td>\n",
       "      <td>95006554.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2019-01-09</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>109.2285</td>\n",
       "      <td>9349245.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2019-01-10</td>\n",
       "      <td>/sedol1/2840215</td>\n",
       "      <td>239.5405</td>\n",
       "      <td>96823923.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2019-01-10</td>\n",
       "      <td>/sedol1/2971546</td>\n",
       "      <td>108.5257</td>\n",
       "      <td>8222860.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date         security   PX_LAST       VOLUME\n",
       "0  2019-01-02  /sedol1/2840215  231.4905  126925199.0\n",
       "1  2019-01-02  /sedol1/2971546  110.0483   19841527.0\n",
       "2  2019-01-03  /sedol1/2840215  225.9664  144140692.0\n",
       "3  2019-01-03  /sedol1/2971546  111.3006   21187045.0\n",
       "4  2019-01-04  /sedol1/2840215  233.5354  142628834.0\n",
       "5  2019-01-04  /sedol1/2971546  110.0123   12970226.0\n",
       "6  2019-01-07  /sedol1/2840215  235.3767  103139100.0\n",
       "7  2019-01-07  /sedol1/2971546  109.6879    8498104.0\n",
       "8  2019-01-08  /sedol1/2840215  237.5882  102512587.0\n",
       "9  2019-01-08  /sedol1/2971546  109.3996    7737103.0\n",
       "10 2019-01-09  /sedol1/2840215  238.6985   95006554.0\n",
       "11 2019-01-09  /sedol1/2971546  109.2285    9349245.0\n",
       "12 2019-01-10  /sedol1/2840215  239.5405   96823923.0\n",
       "13 2019-01-10  /sedol1/2971546  108.5257    8222860.0"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery.bdh(\n",
    "    [\"/sedol1/2840215\", \"/sedol1/2971546\"],\n",
    "    [\"PX_LAST\", \"VOLUME\"],\n",
    "    start_date=\"20190101\",\n",
    "    end_date=\"20190110\",\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Troubleshooting\n",
    "\n",
    "The most frequent errors in `blpapi` are due to poor input. As `blp` is a wrapper for `blpapi`, these errors are passed to the user. To resolve them, examine the error message for issues, then contact the Bloomberg help desk.\n",
    "\n",
    "For instance, the code below will produce an error because it includes an invalid ticker.\n",
    "\n",
    "```python\n",
    "bquery.bdh(\n",
    "    [\"NOT_A_TICKER US Equity\", \"SPY US Equity\"],\n",
    "    [\"PX_LAST\", \"VOLUME\"],\n",
    "    start_date=\"20190101\",\n",
    "    end_date=\"20190110\",\n",
    ")\n",
    "```\n",
    "```\n",
    "TypeError: Response for 'NOT_A_TICKER US Equity' contains securityError\n",
    "{\n",
    "    \"securityError\": {\n",
    "        \"source\": \"3923::bbdbh4\",\n",
    "        \"code\": 15,\n",
    "        \"category\": \"BAD_SEC\",\n",
    "        \"message\": \"Unknown/Invalid securityInvalid Security [nid:3923] \",\n",
    "        \"subcategory\": \"INVALID_SECURITY\",\n",
    "    }\n",
    "}\n",
    "```\n",
    "\n",
    "To ignore errors, instantiate a parser as shown below:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Response for 'NOT_A_TICKER US Equity' contains securityError {'securityError': {'source': '53646:rsfhdsvc2', 'code': 15, 'category': 'BAD_SEC', 'message': 'Unknown/Invalid securityInvalid Security [nid:53646]', 'subcategory': 'INVALID_SECURITY'}}\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>security</th>\n",
       "      <th>PX_LAST</th>\n",
       "      <th>VOLUME</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2019-01-02</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>231.4905</td>\n",
       "      <td>126925199.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2019-01-03</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>225.9664</td>\n",
       "      <td>144140692.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2019-01-04</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>233.5354</td>\n",
       "      <td>142628834.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2019-01-07</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>235.3767</td>\n",
       "      <td>103139100.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2019-01-08</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>237.5882</td>\n",
       "      <td>102512587.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2019-01-09</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>238.6985</td>\n",
       "      <td>95006554.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2019-01-10</td>\n",
       "      <td>SPY US Equity</td>\n",
       "      <td>239.5405</td>\n",
       "      <td>96823923.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        date       security   PX_LAST       VOLUME\n",
       "0 2019-01-02  SPY US Equity  231.4905  126925199.0\n",
       "1 2019-01-03  SPY US Equity  225.9664  144140692.0\n",
       "2 2019-01-04  SPY US Equity  233.5354  142628834.0\n",
       "3 2019-01-07  SPY US Equity  235.3767  103139100.0\n",
       "4 2019-01-08  SPY US Equity  237.5882  102512587.0\n",
       "5 2019-01-09  SPY US Equity  238.6985   95006554.0\n",
       "6 2019-01-10  SPY US Equity  239.5405   96823923.0"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "bquery = blp.BlpQuery(parser=blp.BlpParser(raise_security_errors=False)).start()\n",
    "\n",
    "bquery.bdh(\n",
    "    [\"NOT_A_TICKER US Equity\", \"SPY US Equity\"],\n",
    "    [\"PX_LAST\", \"VOLUME\"],\n",
    "    start_date=\"20190101\",\n",
    "    end_date=\"20190110\",\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Additional Features\n",
    "\n",
    "## Retrieve JSON Data\n",
    "\n",
    "### Query Generation Utility Methods"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{\n",
      "  \"HistoricalDataRequest\": {\n",
      "    \"securities\": [\n",
      "      \"SPY US Equity\"\n",
      "    ],\n",
      "    \"fields\": [\n",
      "      \"VOLUME\"\n",
      "    ],\n",
      "    \"startDate\": \"20190101\",\n",
      "    \"endDate\": \"20190105\"\n",
      "  }\n",
      "}\n"
     ]
    }
   ],
   "source": [
    "query = blp.create_query(\n",
    "    request_type=\"HistoricalDataRequest\",\n",
    "    values={\n",
    "        \"securities\": [\"SPY US Equity\"],\n",
    "        \"fields\": [\"VOLUME\"],\n",
    "        \"startDate\": \"20190101\",\n",
    "        \"endDate\": \"20190105\",\n",
    "    },\n",
    ")\n",
    "print(json.dumps(query, indent=2))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "# deal with Timestamps for pretty printing for response\n",
    "\n",
    "def ts_to_json(obj):\n",
    "    return obj.strftime(\"%Y-%m-%dT%H:%M:%S.%f%z\")\n",
    "\n",
    "\n",
    "def time_to_json(obj):\n",
    "    return obj.strftime(\"%H:%M:%S\")\n",
    "\n",
    "class CustomJSONEncoder(json.JSONEncoder):\n",
    "    def default(self, obj):\n",
    "        if isinstance(obj, pandas.Timestamp):\n",
    "            return ts_to_json(obj)\n",
    "        if isinstance(obj, datetime.time):\n",
    "            return time_to_json(obj)\n",
    "        return super().default(obj)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[\n",
      "  {\n",
      "    \"eventType\": 5,\n",
      "    \"eventTypeName\": \"blpapi.Event.RESPONSE\",\n",
      "    \"messageNumber\": 0,\n",
      "    \"message\": {\n",
      "      \"fragmentType\": 0,\n",
      "      \"correlationIds\": [\n",
      "        33\n",
      "      ],\n",
      "      \"messageType\": \"HistoricalDataResponse\",\n",
      "      \"timeReceived\": \"2023-11-21T04:17:39.755538+0000\",\n",
      "      \"element\": {\n",
      "        \"HistoricalDataResponse\": {\n",
      "          \"securityData\": {\n",
      "            \"security\": \"SPY US Equity\",\n",
      "            \"eidData\": [],\n",
      "            \"sequenceNumber\": 0,\n",
      "            \"fieldExceptions\": [],\n",
      "            \"fieldData\": [\n",
      "              {\n",
      "                \"fieldData\": {\n",
      "                  \"date\": \"2019-01-02T00:00:00.000000\",\n",
      "                  \"VOLUME\": 126925199.0\n",
      "                }\n",
      "              },\n",
      "              {\n",
      "                \"fieldData\": {\n",
      "                  \"date\": \"2019-01-03T00:00:00.000000\",\n",
      "                  \"VOLUME\": 144140692.0\n",
      "                }\n",
      "              },\n",
      "              {\n",
      "                \"fieldData\": {\n",
      "                  \"date\": \"2019-01-04T00:00:00.000000\",\n",
      "                  \"VOLUME\": 142628834.0\n",
      "                }\n",
      "              }\n",
      "            ]\n",
      "          }\n",
      "        }\n",
      "      }\n",
      "    }\n",
      "  }\n",
      "]\n"
     ]
    }
   ],
   "source": [
    "resp = bquery.query(query, parse=False, collector=list)\n",
    "print(json.dumps(resp, indent=2, cls=CustomJSONEncoder))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Support for Context Manager"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>security</th>\n",
       "      <th>PX_LAST</th>\n",
       "      <th>VOLUME</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2021-01-04</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.3125</td>\n",
       "      <td>40089896.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2021-01-05</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.3425</td>\n",
       "      <td>19845828.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2021-01-06</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.5900</td>\n",
       "      <td>24224992.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2021-01-07</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.5200</td>\n",
       "      <td>24517104.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2021-01-08</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.4225</td>\n",
       "      <td>25927840.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2021-01-11</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.9850</td>\n",
       "      <td>59710448.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2021-01-12</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>4.9875</td>\n",
       "      <td>28242660.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2021-01-13</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>7.8500</td>\n",
       "      <td>578006944.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2021-01-14</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>9.9775</td>\n",
       "      <td>374869640.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2021-01-15</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>8.8750</td>\n",
       "      <td>187465432.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2021-01-19</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>9.8400</td>\n",
       "      <td>298887696.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2021-01-20</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>9.7800</td>\n",
       "      <td>133887156.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2021-01-21</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>10.7575</td>\n",
       "      <td>228319016.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2021-01-22</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>16.2525</td>\n",
       "      <td>788631784.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2021-01-25</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>19.1975</td>\n",
       "      <td>711496000.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2021-01-26</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>36.9950</td>\n",
       "      <td>714351896.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2021-01-27</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>86.8775</td>\n",
       "      <td>373586664.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2021-01-28</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>48.4000</td>\n",
       "      <td>235266380.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2021-01-29</td>\n",
       "      <td>GME US Equity</td>\n",
       "      <td>81.2500</td>\n",
       "      <td>202264220.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date       security  PX_LAST       VOLUME\n",
       "0  2021-01-04  GME US Equity   4.3125   40089896.0\n",
       "1  2021-01-05  GME US Equity   4.3425   19845828.0\n",
       "2  2021-01-06  GME US Equity   4.5900   24224992.0\n",
       "3  2021-01-07  GME US Equity   4.5200   24517104.0\n",
       "4  2021-01-08  GME US Equity   4.4225   25927840.0\n",
       "5  2021-01-11  GME US Equity   4.9850   59710448.0\n",
       "6  2021-01-12  GME US Equity   4.9875   28242660.0\n",
       "7  2021-01-13  GME US Equity   7.8500  578006944.0\n",
       "8  2021-01-14  GME US Equity   9.9775  374869640.0\n",
       "9  2021-01-15  GME US Equity   8.8750  187465432.0\n",
       "10 2021-01-19  GME US Equity   9.8400  298887696.0\n",
       "11 2021-01-20  GME US Equity   9.7800  133887156.0\n",
       "12 2021-01-21  GME US Equity  10.7575  228319016.0\n",
       "13 2021-01-22  GME US Equity  16.2525  788631784.0\n",
       "14 2021-01-25  GME US Equity  19.1975  711496000.0\n",
       "15 2021-01-26  GME US Equity  36.9950  714351896.0\n",
       "16 2021-01-27  GME US Equity  86.8775  373586664.0\n",
       "17 2021-01-28  GME US Equity  48.4000  235266380.0\n",
       "18 2021-01-29  GME US Equity  81.2500  202264220.0"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "with blp.BlpQuery() as bq:\n",
    "    df = bq.bdh(\n",
    "        [\"GME US Equity\"],\n",
    "        [\"PX_LAST\", \"VOLUME\"],\n",
    "        start_date=\"20210101\",\n",
    "        end_date=\"20210130\",\n",
    "    )\n",
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Streaming Data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "SESSION_STATUS - Message 0 - SessionConnectionDown = {\n",
      "    server = \"localhost:8194\"\n",
      "}\n",
      "\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{\n",
      "  \"fragmentType\": 0,\n",
      "  \"correlationIds\": [\n",
      "    \"USDCAD Curncy\"\n",
      "  ],\n",
      "  \"messageType\": \"MarketDataEvents\",\n",
      "  \"timeReceived\": \"2023-11-21T04:17:42.131746+0000\",\n",
      "  \"element\": {\n",
      "    \"MarketDataEvents\": {\n",
      "      \"MKTDATA_EVENT_TYPE\": \"SUMMARY\",\n",
      "      \"MKTDATA_EVENT_SUBTYPE\": \"INITPAINT\",\n",
      "      \"BID\": 1.3706,\n",
      "      \"ASK\": 1.3707,\n",
      "      \"BEST_BID\": 1.3706,\n",
      "      \"BEST_ASK\": 1.3707,\n",
      "      \"BID_ALL_SESSION\": 1.3706,\n",
      "      \"ASK_ALL_SESSION\": 1.3707,\n",
      "      \"IND_BID_FLAG\": false,\n",
      "      \"IND_ASK_FLAG\": false,\n",
      "      \"BID_TDY\": 1.3706,\n",
      "      \"PRICE_LAST_BID_RT\": 1.3706,\n",
      "      \"ASK_TDY\": 1.3707,\n",
      "      \"PRICE_LAST_ASK_RT\": 1.3707,\n",
      "      \"BID_DIR\": 1,\n",
      "      \"ASK_DIR\": 1,\n",
      "      \"BID2\": 1.3706,\n",
      "      \"ASK2\": 1.3707,\n",
      "      \"BID_ALL_SESSION_TDY_RT\": 1.3706,\n",
      "      \"ASK_ALL_SESSION_TDY_RT\": 1.3707,\n",
      "      \"CURRENT_SESSION_RT\": 2,\n",
      "      \"PX_OPEN_ALL_WITH_SWITCHOVER_RT\": 1.3724546432495117,\n",
      "      \"PX_CLOSE_ALL_WITH_SWITCHOVER_RT\": 1.3725,\n",
      "      \"LAST_PRICE_ALL_SESSION_DIR_RT\": 1,\n",
      "      \"SIMP_LAST_PX_ALL_SESS_DIR_RT\": 1,\n",
      "      \"ID_BB_SEC_NUM_SRC\": 12884922137,\n",
      "      \"LAST_PRICE\": 1.3707,\n",
      "      \"LAST2_TRADE\": 1.3707,\n",
      "      \"HIGH\": 1.373,\n",
      "      \"LOW\": 1.3705,\n",
      "      \"OPEN\": 1.3725,\n",
      "      \"OPEN_TDY\": 1.3725,\n",
      "      \"PRICE_OPEN_RT\": 1.3725,\n",
      "      \"LAST_PRICE_TDY\": 1.3707,\n",
      "      \"HIGH_TDY\": 1.373,\n",
      "      \"PRICE_HIGH_RT\": 1.373,\n",
      "      \"LOW_TDY\": 1.3705,\n",
      "      \"PRICE_LOW_RT\": 1.3705,\n",
      "      \"MID\": 1.3706,\n",
      "      \"MID_TDY\": 1.3706,\n",
      "      \"RT_EXCH_MARKET_STATUS\": \"ACTV\",\n",
      "      \"LAST_ALL_SESSIONS\": 1.3707,\n",
      "      \"PREV_CLOSE_VALUE_REALTIME\": 1.3725,\n",
      "      \"TRADING_DT_REALTIME\": \"2023-11-21T00:00:00.000000\",\n",
      "      \"PREV_TRADING_DT_REALTIME\": \"2023-11-20T00:00:00.000000\",\n",
      "      \"PRICE_CHANGE_1Y_NET_RT\": 0.02590000070631504,\n",
      "      \"PRICE_CHANGE_1Y_PCT_RT\": 1.9221999645233154,\n",
      "      \"CLOSING_PRICE_1Y_AGO_RT\": 1.3447999954223633,\n",
      "      \"ZERO_BID_PRICE_INDICATOR_RT\": true,\n",
      "      \"ZERO_ASK_PRICE_INDICATOR_RT\": true,\n",
      "      \"RT_API_MACHINE\": \"apipubx0@md1p-rr-004\",\n",
      "      \"PX_LOW_BID_RT\": 1.3704500198364258,\n",
      "      \"PX_HIGH_ASK_RT\": 1.3736000061035156,\n",
      "      \"PX_HIGH_BID_RT\": 1.372910499572754,\n",
      "      \"PX_LOW_ASK_RT\": 1.3705700635910034,\n",
      "      \"ALL_PRICE\": 1.3707,\n",
      "      \"MID2\": 1.3706,\n",
      "      \"MID_DIR\": 1,\n",
      "      \"RT_PRICING_SOURCE\": \"BGN\",\n",
      "      \"ASK_CHANGE\": -0.0019001174926758235,\n",
      "      \"BID_CHANGE\": -0.0017002532958985128,\n",
      "      \"SPREAD_BA\": 0.0001,\n",
      "      \"PRICE_52_WEEK_HIGH_RT\": 1.3899,\n",
      "      \"PRICE_52_WEEK_HIGH_DATE_RT\": \"2023-11-01T00:00:00.000000\",\n",
      "      \"PRICE_52_WEEK_LOW_RT\": 1.3093,\n",
      "      \"PRICE_52_WEEK_LOW_DATE_RT\": \"2023-07-14T00:00:00.000000\",\n",
      "      \"PRICE_PREVIOUS_CLOSE_RT\": 1.3725,\n",
      "      \"PRICE_LAST_RT\": 1.3707,\n",
      "      \"PREVIOUS_CLOSE_BID_PRICE_RT\": 1.3723,\n",
      "      \"PREVIOUS_CLOSE_ASK_PRICE_RT\": 1.3726,\n",
      "      \"LAST_CONTINUOUS_TRADE_PRICE_RT\": 1.3707,\n",
      "      \"LAST_TRADE_CANCELED_IND_RT\": false,\n",
      "      \"UNADJUSTED_PREV_LAST_PRICE_RT\": 1.3725,\n",
      "      \"ADJUSTED_PREV_LAST_PRICE_RT\": 1.3725,\n",
      "      \"BASE_PRICE_ENABLED_RT\": false,\n",
      "      \"BB_STANDARD_CC_AVAIL_RT\": false,\n",
      "      \"NUM_TRADES_RT\": 0,\n",
      "      \"BLOOMBERG_CLOSE_METHOD_RT\": \"NA\",\n",
      "      \"LAST_TICK_DIRECTION_RT\": 0,\n",
      "      \"CHG_NET_REG_SES_PRV_RG_SES_CL_RT\": -0.0018019676208496094,\n",
      "      \"CHG_PCT_REG_SES_PRV_RG_SES_CL_RT\": -0.13129546830859543,\n",
      "      \"ALT_BOOK_BEST_ASK_CC_RT\": null,\n",
      "      \"ALT_BOOK_NAME_RT\": null,\n",
      "      \"ALT_BOOK_BEST_BID_CC_RT\": null,\n",
      "      \"MIN_NEGOTIATED_TRADE_SIZE_RT\": null,\n",
      "      \"SETTLMNT_PX_ALTRNTVE_NOTTN_RT\": null,\n",
      "      \"ALT_BOOK_BEST_BID_NUM_OF_ORDR_RT\": null,\n",
      "      \"ALT_BOOK_BEST_ASK_NUM_OF_ORDR_RT\": null,\n",
      "      \"SETTLMNT_PX_ALT_NOTTN_METHOD_RT\": null,\n",
      "      \"SHORTENED_BID_ASK_RT\": \"1.3706/07\",\n",
      "      \"IS_DELAYED_STREAM\": false,\n",
      "      \"CHG_NET_MTD_RT\": -0.0168,\n",
      "      \"CHG_PCT_MTD_RT\": -1.2108,\n",
      "      \"CHG_NET_QTD_RT\": 0.013,\n",
      "      \"CHG_PCT_QTD_RT\": 0.9575,\n",
      "      \"CHG_NET_YTD_RT\": 0.0153,\n",
      "      \"CHG_PCT_YTD_RT\": 1.1288,\n",
      "      \"CHG_NET_1M_RT\": 0.0016,\n",
      "      \"CHG_PCT_1M_RT\": 0.1169,\n",
      "      \"CHG_NET_3M_RT\": 0.0163,\n",
      "      \"CHG_PCT_3M_RT\": 1.2035,\n",
      "      \"REALTIME_2_DAY_CHANGE_NET\": -0.0016,\n",
      "      \"REALTIME_2_DAY_CHANGE_PERCENT\": -0.1166,\n",
      "      \"REALTIME_5_DAY_CHANGE_NET\": 0.0014,\n",
      "      \"REALTIME_5_DAY_CHANGE_PERCENT\": 0.1022,\n",
      "      \"RT_PX_AS_PCT_INTRADAY_RANGE\": 8.0,\n",
      "      \"REALTIME_PERCENT_BID_ASK_SPREAD\": 0.00730000000000075,\n",
      "      \"CHG_NET_1D_ALL_FROM_REGULAR_RT\": -0.0018,\n",
      "      \"CHG_PCT_1D_ALL_FROM_REGULAR_RT\": -0.1311,\n",
      "      \"PX_CHG_NET_1D_ALL_SWITCHOVER_RT\": -0.0018,\n",
      "      \"PX_CHG_PCT_1D_ALL_SWITCHOVER_RT\": -0.1311,\n",
      "      \"API_RULES_VERSION\": 201411210,\n",
      "      \"PREV_SES_LAST_PRICE\": 1.3725,\n",
      "      \"RT_PX_CHG_NET_1D\": -0.0018,\n",
      "      \"RT_PX_CHG_PCT_1D\": -0.13109999895095825,\n",
      "      \"PRICE_CHANGE_ON_DAY_RT\": -0.0018,\n",
      "      \"NET_CHANGE_ON_DAY_TODAY_RT\": -0.0018,\n",
      "      \"PERCENT_CHANGE_ON_DAY_TODAY_RT\": -0.1311,\n",
      "      \"LAST_UPDATE_BID_RT\": \"01:17:40\",\n",
      "      \"LAST_UPDATE_ASK_RT\": \"01:17:40\",\n",
      "      \"TIME\": \"01:17:40\",\n",
      "      \"BID_ASK_TIME\": \"01:17:40\",\n",
      "      \"SES_START\": \"19:00:00\",\n",
      "      \"SES_END\": \"18:59:59\",\n",
      "      \"PRICE_LAST_TIME_RT\": \"01:17:40\",\n",
      "      \"LAST_BID_TIME_TODAY_REALTIME\": \"01:17:40\",\n",
      "      \"LAST_ASK_TIME_TODAY_REALTIME\": \"01:17:40\",\n",
      "      \"LAST_PRICE_TIME_TODAY_REALTIME\": \"01:17:40\",\n",
      "      \"LAST_UPDATE_ALL_SESSIONS_RT\": \"01:17:40\"\n",
      "    }\n",
      "  }\n",
      "}\n",
      "{\n",
      "  \"fragmentType\": 0,\n",
      "  \"correlationIds\": [\n",
      "    \"USDCAD Curncy\"\n",
      "  ],\n",
      "  \"messageType\": \"MarketDataEvents\",\n",
      "  \"timeReceived\": \"2023-11-21T04:17:42.131746+0000\",\n",
      "  \"element\": {\n",
      "    \"MarketDataEvents\": {\n",
      "      \"MKTDATA_EVENT_TYPE\": \"TRADE\",\n",
      "      \"MKTDATA_EVENT_SUBTYPE\": \"NEW\",\n",
      "      \"LAST_ALL_SESSIONS\": 1.3707,\n",
      "      \"LAST2_TRADE\": 1.3707,\n",
      "      \"LAST_PRICE\": 1.3707,\n",
      "      \"LAST_PRICE_TDY\": 1.3707,\n",
      "      \"LAST2_DIR\": null,\n",
      "      \"LAST_TICK_DIRECTION_RT\": 0,\n",
      "      \"ALL_PRICE_COND_CODE\": null,\n",
      "      \"ALL_PRICE\": 1.3707,\n",
      "      \"LAST_PRICE_COND_CODE_RT\": null,\n",
      "      \"PRICE_CHANGE_1Y_NET_RT\": 0.02590000070631504,\n",
      "      \"PRICE_CHANGE_1Y_PCT_RT\": 1.9258999824523926,\n",
      "      \"LAST_CONTINUOUS_TRADE_PRICE_RT\": 1.3707,\n",
      "      \"PRICE_LAST_RT\": 1.3707,\n",
      "      \"EVT_TRADE_PRICE_RT\": 1.3707,\n",
      "      \"EVT_TRADE_SIZE_RT\": 0,\n",
      "      \"EVT_TRADE_CONDITION_CODE_RT\": null,\n",
      "      \"EVT_TRADE_SOURCE_TYPE_CODE_RT\": null,\n",
      "      \"EVT_TRADE_INTEGER_IDENTIFIER_RT\": null,\n",
      "      \"EVT_TRADE_IDENTIFIER_RT\": null,\n",
      "      \"EXCH_CODE_LAST_ALL_SESSION_RT\": null,\n",
      "      \"LOC_SRC_FOR_LST_TRD_ALL_SESS_RT\": null,\n",
      "      \"CHG_NET_REG_SESSION_CLOSE\": null,\n",
      "      \"CHG_PCT_REG_SESSION_CLOSE\": null,\n",
      "      \"CHG_NET_PREV_DAY_POST_CLS\": null,\n",
      "      \"CHG_PCT_PREV_DAY_POST_CLS\": null,\n",
      "      \"CHG_NET_1D_PRE_FROM_REGULAR_RT\": null,\n",
      "      \"CHG_PCT_1D_PRE_FROM_REGULAR_RT\": null,\n",
      "      \"CHG_NET_1D_ALL_FROM_REGULAR_RT\": -0.0018,\n",
      "      \"CHG_PCT_1D_ALL_FROM_REGULAR_RT\": -0.1311,\n",
      "      \"CHG_NET_1D_POST_FROM_REGULAR_RT\": null,\n",
      "      \"CHG_PCT_1D_POST_FROM_REGULAR_RT\": null,\n",
      "      \"PX_CHG_NET_1D_ALL_SWITCHOVER_RT\": -0.0018,\n",
      "      \"PX_CHG_PCT_1D_ALL_SWITCHOVER_RT\": -0.1311,\n",
      "      \"CHG_NET_REG_SES_PRV_RG_SES_CL_RT\": -0.0018,\n",
      "      \"CHG_PCT_REG_SES_PRV_RG_SES_CL_RT\": -0.131148,\n",
      "      \"CHG_NET_MTD_RT\": -0.0168,\n",
      "      \"CHG_PCT_MTD_RT\": -1.2108,\n",
      "      \"CHG_NET_QTD_RT\": 0.013,\n",
      "      \"CHG_PCT_QTD_RT\": 0.9575,\n",
      "      \"CHG_NET_YTD_RT\": 0.0153,\n",
      "      \"CHG_PCT_YTD_RT\": 1.1288,\n",
      "      \"CHG_NET_1M_RT\": 0.0016,\n",
      "      \"CHG_PCT_1M_RT\": 0.1169,\n",
      "      \"CHG_NET_3M_RT\": 0.0163,\n",
      "      \"CHG_PCT_3M_RT\": 1.2035,\n",
      "      \"REALTIME_2_DAY_CHANGE_NET\": -0.0016,\n",
      "      \"REALTIME_2_DAY_CHANGE_PERCENT\": -0.1166,\n",
      "      \"REALTIME_5_DAY_CHANGE_NET\": 0.0014,\n",
      "      \"REALTIME_5_DAY_CHANGE_PERCENT\": 0.1022,\n",
      "      \"RT_PX_AS_PCT_INTRADAY_RANGE\": 8.0,\n",
      "      \"REALTIME_PERCENT_BID_ASK_SPREAD\": 0.00730000000000075,\n",
      "      \"RT_THEORETICAL_PCT_CHG_FROM_LAST\": null,\n",
      "      \"REALTIME_15_SEC_PRICE_PCT_CHG\": null,\n",
      "      \"REALTIME_ONE_MIN_PRICE_PCT_CHG\": null,\n",
      "      \"REALTIME_FIVE_MIN_PRICE_PCT_CHG\": null,\n",
      "      \"REALTIME_15_MIN_PRICE_PCT_CHG\": null,\n",
      "      \"REALTIME_ONE_HOUR_PRICE_PCT_CHG\": null,\n",
      "      \"REALTIME_VOLUME_5_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_1_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_5_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_10_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_20_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_30_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_100_DAY_INTERVAL\": null,\n",
      "      \"DELTA_AVAT_180_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_1_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_5_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_10_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_20_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_30_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_100_DAY_INTERVAL\": null,\n",
      "      \"DELTA_ATAT_180_DAY_INTERVAL\": null,\n",
      "      \"RT_PX_CHG_NET_1D\": -0.0018,\n",
      "      \"RT_PX_CHG_PCT_1D\": -0.13109999895095825,\n",
      "      \"PRICE_CHANGE_ON_DAY_RT\": -0.0018,\n",
      "      \"NET_CHANGE_ON_DAY_TODAY_RT\": -0.0018,\n",
      "      \"PERCENT_CHANGE_ON_DAY_TODAY_RT\": -0.1311,\n",
      "      \"LAST_UPDATE_CHG_1D_RT\": -0.0017999999690800905,\n",
      "      \"EVT_TRADE_TIME_RT\": \"01:17:40\",\n",
      "      \"TRADE_UPDATE_STAMP_RT\": \"2023-11-21T01:17:40.000000-0300\",\n",
      "      \"IS_DELAYED_STREAM\": false,\n",
      "      \"EVT_UPDATE_ACTIONS_RT\": 271,\n",
      "      \"TIME\": \"01:17:40\",\n",
      "      \"PRICE_LAST_TIME_RT\": \"01:17:40\",\n",
      "      \"LAST_PRICE_TIME_TODAY_REALTIME\": \"01:17:40\",\n",
      "      \"EVENT_TIME\": \"01:17:40\",\n",
      "      \"LAST_UPDATE_ALL_SESSIONS_RT\": \"01:17:40\",\n",
      "      \"BLOOMBERG_SEND_TIME_RT\": \"2023-11-21T04:17:42.131000+0000\"\n",
      "    }\n",
      "  }\n",
      "}\n"
     ]
    }
   ],
   "source": [
    "with blp.BlpStream() as bs:\n",
    "    bs.subscribe({\"USDCAD Curncy\": {\"fields\": [\"LAST_PRICE\"]}})\n",
    "    n = 0\n",
    "    for ev in bs.events(timeout=60):\n",
    "        print(json.dumps(ev, indent=2, cls=CustomJSONEncoder))\n",
    "        n += 1\n",
    "        if n > 1:\n",
    "            break"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "myenv",
   "language": "python",
   "name": "myenv"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
